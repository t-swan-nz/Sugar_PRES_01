---
title: "Untitled"
author: "Tom Swan"
date: "02/06/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r}
library(ggplot2)
library(emmeans)
library(lme4)
library(tidyverse)
library(psych) 
library(stats) 
library(MASS)
library(car)
library(cowplot)
library(sjPlot)
library(ggpubr)
library(jtools)
```

Import the data
```{r}
PRES_data_no_KOD <- read.csv(file = "PRES_01_no_KOD.csv")
PRES_data_no_KOD$day <- as.factor(PRES_data_no_KOD$day)
str(PRES_data_no_KOD)

```

Testing for normality (data appears to be normal - parametric)
```{r}
shapiro.test(PRES_data_no_KOD$fructose_concentration)

#p-value = 0.3704
#From the output, the p-value > 0.05 implying that the distribution of the data are not significantly different from normal distribution. In other words, we can assume the normality.
```

Create geom_boxplots showing distribution of data

```{r}
PRES_data_no_KOD$treatment2 <- factor(PRES_data_no_KOD$treatment, levels = c("Crushed EtOH", "Whole EtOH", "Heat fixed", "Frozen"))

#PRES_data_no_KOD$treatment3 <- factor(PRES_data_no_KOD$treatment2, levels = 1:4, labels = c("Crushed EtOH", "Whole EtOH", "Heat fixed", "Frozen"))

ggplot(PRES_data_no_KOD, aes(x=treatment2, y= fructose_concentration))+ geom_boxplot() + facet_wrap(~day) + labs(x="", y=expression("Fructose concentration ("~mu*"g /"~mu*"L)")) + theme(axis.text.x = element_text(angle=45, hjust = 1)) 
#order that I would like is W_ETOH, C_ETOH, Frozen, HF

scale_fill_discrete()
#to get the mean
#+ stat_summary(fun.y=mean, geom="point", shape=1, size=3, color="red", fill="red")

#have a graph where day is concatenated over one another (fill = day)

ggplot(PRES_data_no_KOD, aes(x=treatment2, y= fructose_concentration, fill = day))+ geom_boxplot() + labs(x="", y=expression("Fructose concentration ("~mu*"g /"~mu*"L)"), fill = "Day") + theme(axis.text.x = element_text(angle=45, hjust = 1))

```

Run the GLM to see the effect of treatment and day (and interaction)

```{r}
PRES_data_no_KOD_glm_interaction <- glm(fructose_concentration ~ day*treatment, data = PRES_data_no_KOD)
Anova(PRES_data_no_KOD_glm_interaction)

#no significant effect with the interaction. 

#testing the simplified model.

PRES_data_no_KOD_glm <- glm(fructose_concentration ~ day+treatment, data = PRES_data_no_KOD)
summary(PRES_data_no_KOD_glm)
Anova(PRES_data_no_KOD_glm)
summ(PRES_data_no_KOD_glm)

comparisons_PRES_no_KOD <- emmeans(PRES_data_no_KOD_glm, pairwise ~ treatment)
comparisons_PRES_no_KOD



```

There is no significant difference in fructose concentration between days (X2 = 2.1, df =2, p>0.05). There is a significant difference in fructose concentration by treatment (X2 = 39.3, df = 3, p <0.001). Fructose concentration was significantly higher in mosquitoes frozen, and heat fixed compared to those crushed or whole in 80% ethanol (p <0.05). There was no significant difference in fructose concentration between mosquitoes frozen and mosquitoes heat-fixed (p >0.05). There was no significant difference in fructose concentration between mosquitoes crushed in ethanol and mosquitoes stored whole in ethanol (p >0.05).   

Including the KOD data

Importing the new data (with KOD)

```{r}
PRES_data_KOD <- read.csv(file = "PRES_01_R_KOD_June_2021.csv")
PRES_data_KOD$day <- as.factor(PRES_data_KOD$day)
str(PRES_data_KOD)


#low to high
PRES_data_KOD$treatment2 <- factor(PRES_data_KOD$treatment, levels = c("Crushed EtOH", "Whole EtOH", "Heat fixed", "Frozen", "KOD"))

str(PRES_data_KOD)

#change the order from High - Low
PRES_data_KOD$treatment3 <- factor(PRES_data_KOD$treatment, levels = c("KOD","Frozen","Heat fixed","Whole EtOH", "Crushed EtOH"))


```

Visualise the data
```{r}

ggplot(PRES_data_KOD, aes(x=treatment2, y= fructose_concentration))+ geom_boxplot() + facet_wrap(~day) + labs(x="", y=expression("Fructose concentration ("~mu*"g /"~mu*"L)")) + theme(axis.text.x = element_text(angle=45, hjust = 1)) 
#order that I would like is W_ETOH, C_ETOH, Frozen, HF


#have a graph where day is concatenated over one another (fill = day)

ggplot(PRES_data_KOD, aes(x=treatment3, y= fructose_concentration))+ geom_boxplot() + labs(x="", y=expression("Fructose concentration ("~mu*"g /"~mu*"L)"), fill = "Day") + theme(axis.text.x = element_text(angle=45, hjust = 1))


```


Run a GLM on the data
```{r}
PRES_KOD_glm <- glm(fructose_concentration ~ day+treatment, data = PRES_data_KOD)
Anova(PRES_KOD_glm)
#no significant effect with the interaction. 

#test to see if assumptions are okay

#Shapiro-Wilk normality test
shapiro.test(residuals(PRES_KOD_glm))

#violates normality

#Levene Test

leveneTest(residuals(PRES_KOD_glm), PRES_data_KOD$treatment) 
#Levene's test is > 0.05 - no detection of unequal variance. 

#trying to log the response variable fructose concentration (for normality)

PRES_KOD_log_glm <- glm(log(fructose_concentration) ~ day+treatment, data = PRES_data_KOD)
Anova(PRES_KOD_log_glm)
#no significant effect with the interaction. 

#test to see if assumptions are okay

#Shapiro-Wilk normality test
shapiro.test(residuals(PRES_KOD_log_glm))
#does not violate normality

#Levene Test

leveneTest(residuals(PRES_KOD_log_glm), PRES_data_KOD$treatment) 
#Levene's test is < 0.05 - not equal variance. However, it is not hugely below 0.05 and could be argued that the assumption of equal variance for the dependent variable for all groups 'could' be disregarded if you have equal sample sizes for each group. 

#examine post-hoc differences
comparisons_PRES_KOD <- emmeans(PRES_KOD_log_glm, pairwise ~ treatment)
comparisons_PRES_KOD

#no change in results from previously reported (without KOD)

```
